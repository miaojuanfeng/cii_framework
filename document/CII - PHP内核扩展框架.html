<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>CII - PHP内核扩展框架</title>
<link rel="stylesheet" type="text/css" href="static/css/base.lib.min.css">
<link rel="stylesheet" type="text/css" href="static/css/prettify-cmd.css">
<link rel="stylesheet" type="text/css" href="static/css/layout.min.css">
</head>
<body>
<div id="wmd-preview" class="wmd-preview wmd-preview-full-reader"><div class="md-section-divider"></div><div class="md-section-divider"></div><h1 data-anchor-id="gxbt" id="cii-php内核扩展框架">CII - PHP内核扩展框架</h1><hr><p data-anchor-id="byc4">CII 是一个小巧但功能强大的 PHP 扩展框架，作为一个简单优雅的工具包，它可以为 PHP 程序员建立功能完善并且快速的 Web 应用程序。</p><p data-anchor-id="x6y9">如果你已经厌倦了那些傻大笨粗的框架，为 CodeIgniter的运行效率而烦恼，并且你的站点运行在独立主机中，那么 CII 扩展框架就是你所需要的。</p><div class="md-section-divider"></div><h2 data-anchor-id="v3rk" id="特性">特性</h2><ul data-anchor-id="4a30">
<li class="todo-list-item"><i class="icon-check-sign"></i>CII 高性能扩展框架，全称为 CodeIgniter Internal Framework 。</li>
<li class="todo-list-item"><i class="icon-check-sign"></i>这是根据目前非常流行的开源框架 CodeIgniter 的架构，以 PHP 扩展方式实现的框架。</li>
<li class="todo-list-item"><i class="icon-check-sign"></i>完全采用 C 语言编写而成，编译为动态链接库，在 PHP 启动时装载运行。</li>
<li class="todo-list-item"><i class="icon-check-sign"></i>采用 CII 框架开发网站的速度和便利不输于 CodeIgniter 。</li>
<li class="todo-list-item"><i class="icon-check-sign"></i>支持 Codeigniter 框架结构及语法。</li>
<li class="todo-list-item"><i class="icon-check-sign"></i>对比 Codeignter 拥有超过 5 倍的性能提升。</li>
<li class="todo-list-item"><i class="icon-check-sign"></i>对比 Codeignter 减少了 75% 的内存使用。</li>
<li class="todo-list-item"><i class="icon-check-sign"></i>经过线下单元测试与线上长期运行，CII 框架运行时不会产生段错误与内存泄露 。</li>
<li class="todo-list-item"><i class="icon-check-empty"></i>未来的代码优化，会带来更好的性能表现。</li>
</ul><div class="md-section-divider"></div><h2 data-anchor-id="t8g6" id="运行环境">运行环境</h2><p data-anchor-id="wj9n">CII 扩展在以下环境中开发测试及运行：</p><p data-anchor-id="z8y7">OS:</p><ul data-anchor-id="0a55">
<li class="todo-list-item"><i class="icon-check-sign"></i>Ubuntu Kylin 14.04 64bit</li>
<li class="todo-list-item"><i class="icon-check-sign"></i>Windows7 64bit</li>
<li class="todo-list-item"><i class="icon-check-sign"></i>Mac</li>
</ul><p data-anchor-id="0kxy">PHP:</p><ul data-anchor-id="8qld">
<li class="todo-list-item"><i class="icon-check-sign"></i>PHP-5.6.25</li>
</ul><p data-anchor-id="0mdc">Mysql:</p><ul data-anchor-id="uoj7">
<li class="todo-list-item"><i class="icon-check-sign"></i>任何 mysqli 扩展支持的版本</li>
<li class="todo-list-item"><i class="icon-check-empty"></i>目前 CII 扩展只支持连接 Mysql 数据库</li>
</ul><div class="md-section-divider"></div><h2 data-anchor-id="64ae" id="编译安装-cii-框架">编译安装 CII 框架</h2><div class="md-section-divider"></div><h3 data-anchor-id="q0ox" id="1-获取-cii-框架源码">1. 获取 CII 框架源码</h3><p data-anchor-id="ipk8">访问 <a href="https://github.com/miaojuanfeng/cii_framework" target="_blank">Github</a> 获得 CII 框架源码安装包。</p><div class="md-section-divider"></div><h3 data-anchor-id="4dl2" id="2-编译-cii-框架源码">2. 编译 CII 框架源码</h3><p data-anchor-id="ug19">编译安装 PHP 扩展有两种方式：</p><p data-anchor-id="gshb">一种是静态编译，在编译 PHP 时将扩展一起编译进 PHP 程序中。因为扩展编译进了 PHP 中，所以这种编译方式的优点是加载更快，同样缺点也很明显，扩展更新后需要连同 PHP 一起重新编译。</p><p data-anchor-id="cpfr">另外一种是动态编译，也就是将扩展编译成动态链接库，在 PHP 启动后再加载。这种编译方式的优点是，更新了扩展后，只需要重新编译扩展，并且编译成动态链接库可以多进程共享内存，减少内存使用，缺点仅仅是加载慢一点点而已。</p><p data-anchor-id="105b">推荐采用动态编译，需要先编译安装好 PHP 才能采用这种编译方式。</p><div class="md-section-divider"></div><h4 data-anchor-id="dlo4" id="21-在linux-mac下编译安装">2.1. 在Linux / Mac下编译安装</h4><p data-anchor-id="45vh">使用命令行进入 CII 框架源码目录：</p><pre data-anchor-id="z4tj"><code>cd cii_framework
</code></pre><p data-anchor-id="fsjz">使用 phpize 工具生成编译环境：</p><pre data-anchor-id="ir0d"><code>path_to_php/bin/phpize
</code></pre><p data-anchor-id="6j0m">使用 configure 工具配置编译环境：</p><pre data-anchor-id="m2fg"><code>./configure --with-php-config=path_to_php/bin/php-config
</code></pre><p data-anchor-id="qjt2">编译：</p><pre data-anchor-id="isqr"><code>sudo make
</code></pre><p data-anchor-id="5nkl">安装：</p><pre data-anchor-id="vp4o"><code>sudo make install
</code></pre><p data-anchor-id="i17t">运行成功后便会自动将编译好的扩展文件复制到 PHP 扩展文件夹下。</p><div class="md-section-divider"></div><h4 data-anchor-id="upq0" id="22-在windows下编译安装">2.2. 在Windows下编译安装</h4><p data-anchor-id="ex8u">编写中...</p><div class="md-section-divider"></div><h3 data-anchor-id="ib4r" id="3-配置-phpini-文件">3. 配置 php.ini 文件</h3><p data-anchor-id="6ppp">扩展编译完成，并且已经位于 PHP 扩展文件下，接下来就是通知 PHP 启动时加载扩展，编辑 PHP 的配置文件 php.ini，添加：</p><pre data-anchor-id="gj0y"><code>extension=cii.so
</code></pre><p data-anchor-id="gfrb">之后便可检查一下 PHP 是否成功加载了 CII 扩展，在命令行中运行 PHP 程序：</p><pre data-anchor-id="6cdx"><code>path_to_php/bin/php -m
</code></pre><p data-anchor-id="t36v">命令运行后如果在输出的列表中看到有 cii 表示扩展成功加载，如果没有 成功加载，可以检查下 php.ini 配置中的 extension_dir 项。</p><div class="md-section-divider"></div><h2 data-anchor-id="vw7o" id="基本框架结构">基本框架结构</h2><p data-anchor-id="ati1">controllers, modules, views, configs</p><div class="md-section-divider"></div><h2 data-anchor-id="55y1" id="伪继承"><a href="https://www.zybuluo.com/cmd/" target="_blank">伪继承</a></h2><p data-anchor-id="dldx">出于性能考虑，控制器与模型，不采用继承的方式，避免了多次哈希表合并操作。</p><p data-anchor-id="m91b">控制器，模型类自动伪继承基类 CII_Controller 、CII_Model，不需要在控制器或模型脚本中显式继承，继承的工作由 CII 内核完成。脚本位于控制器目录下那它就是一个控制器文件，脚本位于模型目录下那它就是一个模型文件，也就是说不再根据继承的基类来判断是控制器或是模型文件，而是根据文件所在的目录判断。</p><blockquote data-anchor-id="t2ei" class="white-blockquote">
  <p>实际上 CII_Controller、CII_Model 基类是不存在的，CII 内核在控制器初始化过程中向控制器、模型注册了一些成员属性与方法，使得看起来控制器、模型像是继承了某个基类。</p>
</blockquote><p data-anchor-id="dqt9">比如，在控制器目录下编写一个类home:</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="ccyg"><ol class="linenums"><li class="L0"><code class="language-php"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Home</span><span class="pun">{</span></code></li><li class="L1"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> $name</span><span class="pun">;</span></code></li><li class="L2"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> $addr</span><span class="pun">;</span></code></li><li class="L3"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> __construct</span><span class="pun">(){</span></code></li><li class="L4"><code class="language-php"><span class="pln">        $this</span><span class="pun">-&gt;</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"myhome"</span><span class="pun">;</span></code></li><li class="L5"><code class="language-php"><span class="pln">        $this</span><span class="pun">-&gt;</span><span class="pln">addr </span><span class="pun">=</span><span class="pln"> </span><span class="str">"anywhere"</span><span class="pun">;</span></code></li><li class="L6"><code class="language-php"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L7"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> getaddr</span><span class="pun">(){</span></code></li><li class="L8"><code class="language-php"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">addr</span><span class="pun">;</span></code></li><li class="L9"><code class="language-php"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L0"><code class="language-php"><span class="pun">}</span></code></li></ol></pre><p data-anchor-id="jla3">在访问请求到来时，CII 根据路由读取 Home 类，并向 Home 类中添加 CII 框架所需的成员变量与成员函数，然后实例化 Home 类。上面的 Home 类在被 CII 读取后会变为：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="883r"><ol class="linenums"><li class="L0"><code class="language-php"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Home</span><span class="pun">{</span></code></li><li class="L1"><code class="language-php"><span class="pln">    </span><span class="com">/*</span></code></li><li class="L2"><code class="language-php"><span class="com">    *   Home 定义的成员变量</span></code></li><li class="L3"><code class="language-php"><span class="com">    */</span></code></li><li class="L4"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> $name</span><span class="pun">;</span></code></li><li class="L5"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> $addr</span><span class="pun">;</span></code></li><li class="L6"><code class="language-php"><span class="pln">    </span><span class="com">/*</span></code></li><li class="L7"><code class="language-php"><span class="com">    *   CII 添加的成员变量</span></code></li><li class="L8"><code class="language-php"><span class="com">    */</span></code></li><li class="L9"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> $benchmark</span><span class="pun">;</span></code></li><li class="L0"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> $hooks</span><span class="pun">;</span></code></li><li class="L1"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> $config</span><span class="pun">;</span></code></li><li class="L2"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> $log</span><span class="pun">;</span></code></li><li class="L3"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> $uri</span><span class="pun">;</span></code></li><li class="L4"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> $router</span><span class="pun">;</span></code></li><li class="L5"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> $output</span><span class="pun">;</span></code></li><li class="L6"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> $input</span><span class="pun">;</span></code></li><li class="L7"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> $lang</span><span class="pun">;</span></code></li><li class="L8"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> $load</span><span class="pun">;</span></code></li><li class="L9"><code class="language-php"><span class="pln">    </span><span class="com">/*</span></code></li><li class="L0"><code class="language-php"><span class="com">    *   Home 定义的成员函数</span></code></li><li class="L1"><code class="language-php"><span class="com">    */</span></code></li><li class="L2"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> __construct</span><span class="pun">(){</span></code></li><li class="L3"><code class="language-php"><span class="pln">        $this</span><span class="pun">-&gt;</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"myhome"</span><span class="pun">;</span></code></li><li class="L4"><code class="language-php"><span class="pln">        $this</span><span class="pun">-&gt;</span><span class="pln">addr </span><span class="pun">=</span><span class="pln"> </span><span class="str">"anywhere"</span><span class="pun">;</span></code></li><li class="L5"><code class="language-php"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L6"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> getaddr</span><span class="pun">(){</span></code></li><li class="L7"><code class="language-php"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">addr</span><span class="pun">;</span></code></li><li class="L8"><code class="language-php"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L9"><code class="language-php"><span class="pln">    </span><span class="com">/*</span></code></li><li class="L0"><code class="language-php"><span class="com">    *   CII 添加的成员函数</span></code></li><li class="L1"><code class="language-php"><span class="com">    */</span></code></li><li class="L2"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">get_instance</span><span class="pun">(){...}</span></code></li><li class="L3"><code class="language-php"><span class="pun">}</span></code></li></ol></pre><p data-anchor-id="z4mg">CII 添加的成员变量会在 Home 构造函数调用前赋值：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="a4y3"><ol class="linenums"><li class="L0"><code class="language-php"><span class="pln">$benchmark </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> CII_Benchmark</span><span class="pun">();</span></code></li><li class="L1"><code class="language-php"><span class="pln">$hooks     </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> CII_Hooks</span><span class="pun">();</span></code></li><li class="L2"><code class="language-php"><span class="pln">$config    </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> CII_Config</span><span class="pun">();</span></code></li><li class="L3"><code class="language-php"><span class="pln">$log       </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> CII_Log</span><span class="pun">();</span></code></li><li class="L4"><code class="language-php"><span class="pln">$uri       </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> CII_URI</span><span class="pun">();</span></code></li><li class="L5"><code class="language-php"><span class="pln">$router    </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> CII_Router</span><span class="pun">();</span></code></li><li class="L6"><code class="language-php"><span class="pln">$output    </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> CII_Output</span><span class="pun">();</span></code></li><li class="L7"><code class="language-php"><span class="pln">$input     </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> CII_Input</span><span class="pun">();</span></code></li><li class="L8"><code class="language-php"><span class="pln">$lang      </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> CII_Lang</span><span class="pun">();</span></code></li><li class="L9"><code class="language-php"><span class="pln">$load      </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> CII_Load</span><span class="pun">();</span></code></li></ol></pre><p data-anchor-id="p1ma">所以，你可以在控制器 Home 中正常使用这成员变量而不用担心它们未定义：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="n1ja"><ol class="linenums"><li class="L0"><code class="language-php"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Home</span><span class="pun">{</span></code></li><li class="L1"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> $name</span><span class="pun">;</span></code></li><li class="L2"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> $addr</span><span class="pun">;</span></code></li><li class="L3"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> __construct</span><span class="pun">(){</span></code></li><li class="L4"><code class="language-php"><span class="pln">        $this</span><span class="pun">-&gt;</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"myhome"</span><span class="pun">;</span></code></li><li class="L5"><code class="language-php"><span class="pln">        $this</span><span class="pun">-&gt;</span><span class="pln">addr </span><span class="pun">=</span><span class="pln"> </span><span class="str">"anywhere"</span><span class="pun">;</span></code></li><li class="L6"><code class="language-php"><span class="pln">        </span><span class="com">/*</span></code></li><li class="L7"><code class="language-php"><span class="com">        *   不会报错，因为 lang 在 Home 加载过程中定义了</span></code></li><li class="L8"><code class="language-php"><span class="com">        */</span></code></li><li class="L9"><code class="language-php"><span class="pln">        $this</span><span class="pun">-&gt;</span><span class="pln">lang</span><span class="pun">-&gt;</span><span class="pln">load</span><span class="pun">(</span><span class="str">'cii'</span><span class="pun">);</span></code></li><li class="L0"><code class="language-php"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L1"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> getaddr</span><span class="pun">(){</span></code></li><li class="L2"><code class="language-php"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">addr</span><span class="pun">;</span></code></li><li class="L3"><code class="language-php"><span class="pln">        </span><span class="com">/*</span></code></li><li class="L4"><code class="language-php"><span class="com">        *   不会报错，因为 lang 在 Home 加载过程中定义了</span></code></li><li class="L5"><code class="language-php"><span class="com">        */</span></code></li><li class="L6"><code class="language-php"><span class="pln">        $this</span><span class="pun">-&gt;</span><span class="pln">lang</span><span class="pun">-&gt;</span><span class="pln">line</span><span class="pun">(</span><span class="str">'cii_name'</span><span class="pun">);</span></code></li><li class="L7"><code class="language-php"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L8"><code class="language-php"><span class="pun">}</span></code></li></ol></pre><p data-anchor-id="ejfq">在定义类时注意不要重载了伪父类的成员属性与方法，如：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="7uc5"><ol class="linenums"><li class="L0"><code class="language-php"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Home</span><span class="pun">{</span></code></li><li class="L1"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> $name</span><span class="pun">;</span></code></li><li class="L2"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> $addr</span><span class="pun">;</span></code></li><li class="L3"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> $lang</span><span class="pun">;</span></code></li><li class="L4"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> __construct</span><span class="pun">(){</span></code></li><li class="L5"><code class="language-php"><span class="pln">        $this</span><span class="pun">-&gt;</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"myhome"</span><span class="pun">;</span></code></li><li class="L6"><code class="language-php"><span class="pln">        $this</span><span class="pun">-&gt;</span><span class="pln">addr </span><span class="pun">=</span><span class="pln"> </span><span class="str">"anywhere"</span><span class="pun">;</span></code></li><li class="L7"><code class="language-php"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L8"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> getaddr</span><span class="pun">(){</span></code></li><li class="L9"><code class="language-php"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">addr</span><span class="pun">;</span></code></li><li class="L0"><code class="language-php"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L1"><code class="language-php"><span class="pun">}</span></code></li></ol></pre><p data-anchor-id="8klh">在控制器 Home 中声明一个同名成员变量 lang，CII 会认为你想重载这个变量，就不对它进行实例化为 CII_Lang 对象的操作了。当然如果你正想重载 lang，这么做是极好的。</p><p data-anchor-id="o8wz">伪控制器基类定义：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="yav1"><ol class="linenums"><li class="L0"><code class="language-php"><span class="kwd">class</span><span class="pln"> CII_Controller</span><span class="pun">{</span></code></li><li class="L1"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> $benchmark</span><span class="pun">;</span></code></li><li class="L2"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> $hooks</span><span class="pun">;</span></code></li><li class="L3"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> $config</span><span class="pun">;</span></code></li><li class="L4"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> $log</span><span class="pun">;</span></code></li><li class="L5"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> $uri</span><span class="pun">;</span></code></li><li class="L6"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> $router</span><span class="pun">;</span></code></li><li class="L7"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> $output</span><span class="pun">;</span></code></li><li class="L8"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> $input</span><span class="pun">;</span></code></li><li class="L9"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> $lang</span><span class="pun">;</span></code></li><li class="L0"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> $load</span><span class="pun">;</span></code></li><li class="L1"><code class="language-php"></code></li><li class="L2"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">get_instance</span><span class="pun">(){...}</span></code></li><li class="L3"><code class="language-php"><span class="pun">}</span></code></li></ol></pre><p data-anchor-id="zlo6">伪模型基类定义：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="1pwx"><ol class="linenums"><li class="L0"><code class="language-php"><span class="kwd">class</span><span class="pln"> CII_Model</span><span class="pun">{</span></code></li><li class="L1"><code class="language-php"><span class="pln">      </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> __construct</span><span class="pun">(){...}</span></code></li><li class="L2"><code class="language-php"><span class="pln">      </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> __get</span><span class="pun">(){...}</span></code></li><li class="L3"><code class="language-php"><span class="pun">}</span></code></li></ol></pre><hr><div class="md-section-divider"></div><h2 data-anchor-id="f9sw" id="钩子"><a href="https://www.zybuluo.com/cmd/" target="_blank">钩子</a></h2><p data-anchor-id="iq0n">CII 的钩子特性提供了一种方法来修改框架的内部运作流程。CII 的运行遵循着一个特定的流程，你可以参考 CodeIgniter 的应用程序流程图 。但是，有些时候你可能希望在执行流程中的某些阶段添加一些动作，例如在控制器加载之前或之后执行一段脚本，或者在其他的某些位置触发你的脚本。</p><div class="md-section-divider"></div><h3 data-anchor-id="pmi8" id="1-启用钩子">1. 启用钩子</h3><p data-anchor-id="yeue">钩子特性可以在 config/config.php 文件中全局的启用或禁用，设置下面这个参数：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="0i9u"><ol class="linenums"><li class="L0"><code class="language-php"><span class="pln">$config</span><span class="pun">[</span><span class="str">'enable_hooks'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> TRUE</span><span class="pun">;</span></code></li></ol></pre><div class="md-section-divider"></div><h3 data-anchor-id="x4je" id="2-定义钩子">2. 定义钩子</h3><p data-anchor-id="7w25">钩子是在 application/config/hooks.php 文件中被定义的，每个钩子可以定义为下面这样的数组格式:</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="7grt"><ol class="linenums"><li class="L0"><code class="language-php"><span class="pln">$hook</span><span class="pun">[</span><span class="str">'pre_controller'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> array</span><span class="pun">(</span></code></li><li class="L1"><code class="language-php"><span class="pln">    </span><span class="str">'class'</span><span class="pln">    </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="str">'MyClass'</span><span class="pun">,</span></code></li><li class="L2"><code class="language-php"><span class="pln">    </span><span class="str">'function'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="str">'Myfunction'</span><span class="pun">,</span></code></li><li class="L3"><code class="language-php"><span class="pln">    </span><span class="str">'filename'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="str">'Myclass.php'</span><span class="pun">,</span></code></li><li class="L4"><code class="language-php"><span class="pln">    </span><span class="str">'filepath'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="str">''</span><span class="pun">,</span></code></li><li class="L5"><code class="language-php"><span class="pln">    </span><span class="str">'initparams'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> array</span><span class="pun">(</span><span class="str">'a'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'b'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'c'</span><span class="pun">),</span></code></li><li class="L6"><code class="language-php"><span class="pln">    </span><span class="str">'funcparams'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> array</span><span class="pun">(</span><span class="str">'beer'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'wine'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'snacks'</span><span class="pun">)</span></code></li><li class="L7"><code class="language-php"><span class="pun">);</span></code></li></ol></pre><p data-anchor-id="302n">数组的索引为你想使用的挂钩点名称，譬如上例中挂钩点为 pre_controller ， 下面会列出所有可用的挂钩点。钩子数组是一个关联数组，数组的键值以是下面这些：</p><blockquote data-anchor-id="fbtk" class="white-blockquote">
  <ul>
  <li><code>class</code> 你希望调用的类名，如果你更喜欢使用过程式的函数的话，这一项可以留空。</li>
  <li><code>function</code> 你希望调用的方法或函数的名称。</li>
  <li><code>filename</code> 包含你的类或函数的文件名。</li>
  <li><code>filepath</code> 包含你的脚本文件的目录名。 注意： 你的脚本必须放在 hooks/ 目录里面，所以 filepath 是相对 hooks/ 目录的路径，举例来说，如果你的脚本位于 hooks/myhooks/ ，那么 filepath 可以简单的设置为 'myhooks/' ，如果你的脚本位于 hooks/utilities/myhooks/ ， 那么 filepath 可以设置为 'utilities/myhooks/' ，路径后需要加斜线。如果你的脚本位于 hooks/ ，那么 filepath 可留空或省略此项。</li>
  <li><code>initparams</code> 你希望传递给你脚本类的构造函数的任何参数，为数组形式，可选。</li>
  <li><code>funcparams</code> 你希望传递给你脚本函数或方法的任何参数，为数组形式，可选。</li>
  </ul>
</blockquote><div class="md-section-divider"></div><h3 data-anchor-id="cnbr" id="3-多次调用同一个挂钩点">3. 多次调用同一个挂钩点</h3><p data-anchor-id="bom3">如果你想在同一个挂钩点处添加多个脚本，只需要将钩子数组变成二维数组即可，像这样:</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="edtx"><ol class="linenums"><li class="L0"><code class="language-php"><span class="pln">$hook</span><span class="pun">[</span><span class="str">'pre_controller'</span><span class="pun">][]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> array</span><span class="pun">(</span></code></li><li class="L1"><code class="language-php"><span class="pln">    </span><span class="str">'class'</span><span class="pln">    </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="str">'MyClass'</span><span class="pun">,</span></code></li><li class="L2"><code class="language-php"><span class="pln">    </span><span class="str">'function'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="str">'MyMethod'</span><span class="pun">,</span></code></li><li class="L3"><code class="language-php"><span class="pln">    </span><span class="str">'filename'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="str">'Myclass.php'</span><span class="pun">,</span></code></li><li class="L4"><code class="language-php"><span class="pln">    </span><span class="str">'filepath'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="str">''</span><span class="pun">,</span></code></li><li class="L5"><code class="language-php"><span class="pln">    </span><span class="str">'initparams'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> array</span><span class="pun">(</span><span class="str">'a'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'b'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'c'</span><span class="pun">),</span></code></li><li class="L6"><code class="language-php"><span class="pln">    </span><span class="str">'funcparams'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> array</span><span class="pun">(</span><span class="str">'beer'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'wine'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'snacks'</span><span class="pun">)</span></code></li><li class="L7"><code class="language-php"><span class="pun">);</span></code></li><li class="L8"><code class="language-php"></code></li><li class="L9"><code class="language-php"><span class="pln">$hook</span><span class="pun">[</span><span class="str">'pre_controller'</span><span class="pun">][]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> array</span><span class="pun">(</span></code></li><li class="L0"><code class="language-php"><span class="pln">    </span><span class="str">'class'</span><span class="pln">    </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="str">'MyOtherClass'</span><span class="pun">,</span></code></li><li class="L1"><code class="language-php"><span class="pln">    </span><span class="str">'function'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="str">'MyOtherMethod'</span><span class="pun">,</span></code></li><li class="L2"><code class="language-php"><span class="pln">    </span><span class="str">'filename'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="str">'Myotherclass.php'</span><span class="pun">,</span></code></li><li class="L3"><code class="language-php"><span class="pln">    </span><span class="str">'filepath'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="str">''</span><span class="pun">,</span></code></li><li class="L4"><code class="language-php"><span class="pln">    </span><span class="str">'initparams'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> array</span><span class="pun">(</span><span class="str">'a'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'b'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'c'</span><span class="pun">),</span></code></li><li class="L5"><code class="language-php"><span class="pln">    </span><span class="str">'funcparams'</span><span class="pln">   </span><span class="pun">=&gt;</span><span class="pln"> array</span><span class="pun">(</span><span class="str">'red'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'yellow'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'blue'</span><span class="pun">)</span></code></li><li class="L6"><code class="language-php"><span class="pun">);</span></code></li></ol></pre><p data-anchor-id="rs8z">注意数组索引后面多了个中括号:</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="8dr9"><ol class="linenums"><li class="L0"><code class="language-php"><span class="pln">$hook</span><span class="pun">[</span><span class="str">'pre_controller'</span><span class="pun">][]</span></code></li></ol></pre><p data-anchor-id="pca5">这可以让你在同一个挂钩点处执行多个脚本，多个脚本执行顺序就是你定义数组的顺序。</p><div class="md-section-divider"></div><h3 data-anchor-id="em8l" id="4-挂钩点">4. 挂钩点</h3><p data-anchor-id="snvw">以下是所有可用挂钩点的一份列表：</p><blockquote data-anchor-id="sprw" class="white-blockquote">
  <ul>
  <li><code>pre_system</code> 在系统执行的早期调用，这个时候只有 基准测试类 和 钩子类 被加载了， 还没有执行到路由或其他的流程。</li>
  <li><code>pre_controller</code> 在你的控制器调用之前执行，所有的基础类都已加载，路由和安全检查也已经完成。</li>
  <li><code>post_controller_constructor</code> 在你的控制器实例化之后立即执行，控制器的任何方法都还尚未调用。</li>
  <li><code>post_controller</code> 在你的控制器完全运行结束时执行。 <br>
  display_override 覆盖 _display() 方法，该方法用于在系统执行结束时向浏览器发送最终的页面结果。 这可以让你有自己的显示页面的方法。注意你可能需要使用 <code>$this-&gt;CII =&amp; cii_get_instance()</code> 方法来获取 CII 超级对象，以及使用 <code>$this-&gt;CII-&gt;output-&gt;get_output()</code> 方法来 获取最终的显示数据。</li>
  <li><code>cache_override</code> 使用你自己的方法来替代 输出类 中的 _display_cache() 方法，这让你有自己的缓存显示机制。</li>
  <li><code>post_system</code> 在最终的页面发送到浏览器之后、在系统的最后期被调用。</li>
  </ul>
</blockquote><hr><div class="md-section-divider"></div><h2 data-anchor-id="9guv" id="基准测试类"><a href="http://www.baidu.com" target="_blank">基准测试类</a></h2><p data-anchor-id="aj2i">CII 有一个一直都是启用状态的基准测试类，用于计算两个标记点之间的时间差。该类是由系统自动加载，无需手动加载。</p><p data-anchor-id="m78x">另外，基准测试总是在框架被调用的那一刻开始，在输出类向浏览器发送最终的视图之前结束。这样可以显示出整个系统执行的精确时间。</p><div class="md-section-divider"></div><h3 data-anchor-id="9i1y" id="1-使用基准测试类">1. 使用基准测试类</h3><p data-anchor-id="zehf">基准测试类可以在你的 控制器、视图 以及 模型 中使用。</p><p data-anchor-id="i6xa">使用流程如下：</p><blockquote data-anchor-id="qnzr" class="white-blockquote">
  <ol>
  <li>标记一个起始点</li>
  <li>标记一个结束点</li>
  <li>使用 elapsed_time 函数计算时间差。</li>
  </ol>
</blockquote><p data-anchor-id="4f1y">这里是个真实的代码示例:</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="saxi"><ol class="linenums"><li class="L0"><code class="language-php"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">benchmark</span><span class="pun">-&gt;</span><span class="pln">mark</span><span class="pun">(</span><span class="str">'code_start'</span><span class="pun">);</span></code></li><li class="L1"><code class="language-php"></code></li><li class="L2"><code class="language-php"><span class="com">// 一些程序代码...</span></code></li><li class="L3"><code class="language-php"></code></li><li class="L4"><code class="language-php"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">benchmark</span><span class="pun">-&gt;</span><span class="pln">mark</span><span class="pun">(</span><span class="str">'code_end'</span><span class="pun">);</span></code></li><li class="L5"><code class="language-php"></code></li><li class="L6"><code class="language-php"><span class="pln">echo $this</span><span class="pun">-&gt;</span><span class="pln">benchmark</span><span class="pun">-&gt;</span><span class="pln">elapsed_time</span><span class="pun">(</span><span class="str">'code_start'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'code_end'</span><span class="pun">);</span></code></li></ol></pre><p data-anchor-id="9yxf">"code_start" 和 "code_end" 这两个单词是随意的，它们只是两个用于标记的单词而已，你可以任意使用其他你想使用的单词，另外，你也可以设置多个标记点。</p><p data-anchor-id="gyyn">看如下示例:</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="9n4p"><ol class="linenums"><li class="L0"><code class="language-php"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">benchmark</span><span class="pun">-&gt;</span><span class="pln">mark</span><span class="pun">(</span><span class="str">'dog'</span><span class="pun">);</span></code></li><li class="L1"><code class="language-php"></code></li><li class="L2"><code class="language-php"><span class="com">// 一些程序代码...</span></code></li><li class="L3"><code class="language-php"></code></li><li class="L4"><code class="language-php"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">benchmark</span><span class="pun">-&gt;</span><span class="pln">mark</span><span class="pun">(</span><span class="str">'cat'</span><span class="pun">);</span></code></li><li class="L5"><code class="language-php"></code></li><li class="L6"><code class="language-php"><span class="com">// 更多的程序代码...</span></code></li><li class="L7"><code class="language-php"></code></li><li class="L8"><code class="language-php"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">benchmark</span><span class="pun">-&gt;</span><span class="pln">mark</span><span class="pun">(</span><span class="str">'bird'</span><span class="pun">);</span></code></li><li class="L9"><code class="language-php"></code></li><li class="L0"><code class="language-php"><span class="pln">echo $this</span><span class="pun">-&gt;</span><span class="pln">benchmark</span><span class="pun">-&gt;</span><span class="pln">elapsed_time</span><span class="pun">(</span><span class="str">'dog'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'cat'</span><span class="pun">);</span></code></li><li class="L1"><code class="language-php"><span class="pln">echo $this</span><span class="pun">-&gt;</span><span class="pln">benchmark</span><span class="pun">-&gt;</span><span class="pln">elapsed_time</span><span class="pun">(</span><span class="str">'cat'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'bird'</span><span class="pun">);</span></code></li><li class="L2"><code class="language-php"><span class="pln">echo $this</span><span class="pun">-&gt;</span><span class="pln">benchmark</span><span class="pun">-&gt;</span><span class="pln">elapsed_time</span><span class="pun">(</span><span class="str">'dog'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'bird'</span><span class="pun">);</span></code></li></ol></pre><div class="md-section-divider"></div><h3 data-anchor-id="b4m8" id="2-在性能分析器中使用基准测试点">2. 在性能分析器中使用基准测试点</h3><p data-anchor-id="6jfr">如果你希望你的基准测试数据显示在性能分析器中， 那么你的标记点就需要成对出现，而且标记点名称需要以 _start 和 _end 结束， 每一对的标记点名称应该一致。例如:</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="vy5c"><ol class="linenums"><li class="L0"><code class="language-php"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">benchmark</span><span class="pun">-&gt;</span><span class="pln">mark</span><span class="pun">(</span><span class="str">'my_mark_start'</span><span class="pun">);</span></code></li><li class="L1"><code class="language-php"></code></li><li class="L2"><code class="language-php"><span class="com">// 一些程序代码...</span></code></li><li class="L3"><code class="language-php"></code></li><li class="L4"><code class="language-php"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">benchmark</span><span class="pun">-&gt;</span><span class="pln">mark</span><span class="pun">(</span><span class="str">'my_mark_end'</span><span class="pun">);</span></code></li><li class="L5"><code class="language-php"></code></li><li class="L6"><code class="language-php"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">benchmark</span><span class="pun">-&gt;</span><span class="pln">mark</span><span class="pun">(</span><span class="str">'another_mark_start'</span><span class="pun">);</span></code></li><li class="L7"><code class="language-php"></code></li><li class="L8"><code class="language-php"><span class="com">// 更多的程序代码...</span></code></li><li class="L9"><code class="language-php"></code></li><li class="L0"><code class="language-php"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">benchmark</span><span class="pun">-&gt;</span><span class="pln">mark</span><span class="pun">(</span><span class="str">'another_mark_end'</span><span class="pun">);</span></code></li></ol></pre><div class="md-section-divider"></div><h3 data-anchor-id="yh38" id="3-显示总执行时间">3. 显示总执行时间</h3><p data-anchor-id="3d3z">如果你想显示从 CII 运行开始到最终结果输出到浏览器之间花费的总时间，只需简单的将下面这行代码放入你的视图文件中:</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="xzo8"><ol class="linenums"><li class="L0"><code class="language-php"><span class="pun">&lt;?</span><span class="pln">php echo $this</span><span class="pun">-&gt;</span><span class="pln">benchmark</span><span class="pun">-&gt;</span><span class="pln">elapsed_time</span><span class="pun">();?&gt;</span></code></li></ol></pre><p data-anchor-id="zpl0">你大概也注意到了，这个方法和上面例子中的介绍的那个计算两个标记点之间时间差的方法是一样的，只是不带任何参数。当不设参数时，CII 在向浏览器输出最终结果之前不会停止计时，所以无论你在哪里使用该方法，输出的计时结果都是总执行时间。</p><p data-anchor-id="jhnq">这个方法不带参数时返回字符串 “{elapsed_time}”，需要echo出来或赋值给变量，字符串将在视图输出前被替换成具体的时间。</p><p data-anchor-id="qihp">不能在视图中直接输出字符串 “{elapsed_time}” 的方式来显示总执行时间:</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="zdmk"><ol class="linenums"><li class="L0"><code class="language-php"><span class="pun">&lt;?</span><span class="pln">php echo </span><span class="str">"{elapsed_time}"</span><span class="pun">;</span><span class="pln"> </span><span class="pun">?&gt;</span></code></li></ol></pre><p data-anchor-id="nvbt">这样做字符串不会被替换。</p><p data-anchor-id="e4w9">如果你想在你的控制器方法中进行基准测试，你需要设置你自己的标记起始点和结束点。</p><div class="md-section-divider"></div><h3 data-anchor-id="tkbo" id="4-显示内存占用">4. 显示内存占用</h3><p data-anchor-id="g1m9">如果你的 PHP 在安装时使用了 <code>--enable-memory-limit</code> 参数进行编译，你就可以在你的视图文件中使用下面这行代码来显示整个系统所占用的内存大小:</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="4ace"><ol class="linenums"><li class="L0"><code class="language-php"><span class="pun">&lt;?</span><span class="pln">php echo $this</span><span class="pun">-&gt;</span><span class="pln">benchmark</span><span class="pun">-&gt;</span><span class="pln">memory_usage</span><span class="pun">();?&gt;</span></code></li></ol></pre><p data-anchor-id="jd24">这个方法返回字符串 “{memory_usage}”，需要echo出来或赋值给变量，字符串将在视图输出前被替换成具体的内存大小。</p><p data-anchor-id="04p4">这个方法只能在视图文件中使用，显示的结果代表整个应用所占用的内存大小。</p><p data-anchor-id="i8st">不能在视图中直接输出字符串 “{memory_usage}” 的方式来显示内存大小:</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="b09d"><ol class="linenums"><li class="L0"><code class="language-php"><span class="pun">&lt;?</span><span class="pln">php echo </span><span class="str">"{memory_usage}"</span><span class="pun">;</span><span class="pln"> </span><span class="pun">?&gt;</span></code></li></ol></pre><p data-anchor-id="ukwb">这样做字符串不会被替换。</p><div class="md-section-divider"></div><h3 data-anchor-id="bu8k" id="5-显示内存峰值">5. 显示内存峰值</h3><p data-anchor-id="6v1p">你可以在你的视图文件中使用下面这行代码来显示整个系统所占用的内存峰值大小:</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="6z6h"><ol class="linenums"><li class="L0"><code class="language-php"><span class="pun">&lt;?</span><span class="pln">php echo $this</span><span class="pun">-&gt;</span><span class="pln">benchmark</span><span class="pun">-&gt;</span><span class="pln">memory_peak</span><span class="pun">();?&gt;</span></code></li></ol></pre><p data-anchor-id="nips">这个方法返回字符串 “{memory_peak}”，需要echo出来或赋值给变量，字符串将在视图输出前被替换成具体的内存峰值大小。</p><p data-anchor-id="09zf">这个方法只能在视图文件中使用，显示的结果代表整个应用所占用的内存峰值大小。</p><p data-anchor-id="n4fn">不能在视图中直接输出字符串 “{memory_peak}” 的方式来显示内存峰值大小:</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="uspc"><ol class="linenums"><li class="L0"><code class="language-php"><span class="pun">&lt;?</span><span class="pln">php echo </span><span class="str">"{memory_peak}"</span><span class="pun">;</span><span class="pln"> </span><span class="pun">?&gt;</span></code></li></ol></pre><p data-anchor-id="cac6">这样做字符串不会被替换。</p><div class="md-section-divider"></div><h3 data-anchor-id="3ifz" id="6-为什么不能在视图中直接输出字符串">6. 为什么不能在视图中直接输出字符串</h3><p data-anchor-id="e8c3">上面说道，不能在视图中直接输出字符串 “{elapsed_time}” 的方式来显示总执行时间，不能在视图中直接输出字符串 “{memory_usage}” 的方式来显示内存大小，不能在视图中直接输出字符串 “{memory_peak}” 的方式来显示内存峰值大小。</p><p data-anchor-id="md6v">直接在视图中输出字符串固然很方便，但是 CII 无法判断视图中是否有字符串需要替换，如果在视图中没有字符串需要替换，在视图输出前依旧遍历输出字符串来查找要替换的字符串是很浪费时间并且没意义的，所以 CII 对此进行了性能优化，每次调用 benchmark 对象的方法，要替换字符串的次数加1，调用多少次方法，就替换多少次字符串。调用方法的次数为0，视图输出前不进行查找替换。</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="jwa1"><ol class="linenums"><li class="L0"><code class="language-php"><span class="pun">&lt;?</span><span class="pln">php echo $this</span><span class="pun">-&gt;</span><span class="pln">benchmark</span><span class="pun">-&gt;</span><span class="pln">elapsed_time</span><span class="pun">();?&gt;</span></code></li><li class="L1"><code class="language-php"><span class="pln">{elapsed_time}</span></code></li><li class="L2"><code class="language-php"><span class="pun">&lt;?</span><span class="pln">php echo $this</span><span class="pun">-&gt;</span><span class="pln">benchmark</span><span class="pun">-&gt;</span><span class="pln">elapsed_time</span><span class="pun">();?&gt;</span></code></li></ol></pre><p data-anchor-id="kstt">上面的脚本在视图输出前将替换2次 “{elapsed_time}” 字符串，结果如下：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="ffyv"><ol class="linenums"><li class="L0"><code class="language-php"><span class="lit">0.0012</span></code></li><li class="L1"><code class="language-php"><span class="lit">0.0012</span></code></li><li class="L2"><code class="language-php"><span class="pun">{</span><span class="pln">elapsed_time</span><span class="pun">}</span></code></li></ol></pre><p data-anchor-id="o4rb">最后一次不会被替换。</p><p data-anchor-id="8953">仅做了这一项优化，在视图没有字符串需要替换时，性能提高了7倍。需要替换一次字符串时，性能提高了1倍。这是一种空间换时间的做法，稍稍增加了空间复杂度（需要内存记录替换次数，共12字节），大大降低了时间复杂度。</p><hr><div class="md-section-divider"></div><h2 data-anchor-id="v6qt" id="语言类"><a href="http://www.baidu.com" target="_blank">语言类</a></h2><p data-anchor-id="edwt">语言类提供了一些方法用于获取语言文件和不同语言的文本来实现国际化。</p><p data-anchor-id="3vty">在你的 CII 目录，有一个 language 子目录， 它用于存放一系列的语言文件。你可以创建属于你自己的语言文件，用于提供应用程序的错误消息和其他消息。你另加的消息应该放在 language/ 目录下，每种不同的语言都有相应的一个子目录（例如， 'english' 或者 'chinese'）。</p><p data-anchor-id="0bcc">每个语言都应该有它自己的目录，例如，英语语言文件位于：language/english ，中文语言文件位于：language/chinese。</p><div class="md-section-divider"></div><h3 data-anchor-id="m91f" id="1-处理多语言">1. 处理多语言</h3><p data-anchor-id="j9p1">如果你想让你的应用程序支持多语言，你就需要在 language/ 目录下提供不同语言的文件， 然后在 config/config.php 配置文件中指定默认语言。</p><p data-anchor-id="tnvb">语言文件名需要加上_lang，语言文件夹的例子：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="cp9q"><ol class="linenums"><li class="L0"><code class="language-php"><span class="pln">language</span><span class="pun">/</span></code></li><li class="L1"><code class="language-php"><span class="pln">  english</span><span class="pun">/</span></code></li><li class="L2"><code class="language-php"><span class="pln">      error_messages_lang</span><span class="pun">.</span><span class="pln">php</span></code></li><li class="L3"><code class="language-php"><span class="pln">  chinese</span><span class="pun">/</span></code></li><li class="L4"><code class="language-php"><span class="pln">      </span><span class="pun">...</span></code></li><li class="L5"><code class="language-php"><span class="pln">      email_lang</span><span class="pun">.</span><span class="pln">php</span></code></li><li class="L6"><code class="language-php"><span class="pln">      error_messages_lang</span><span class="pun">.</span><span class="pln">php</span></code></li><li class="L7"><code class="language-php"><span class="pln">      form_validation_lang</span><span class="pun">.</span><span class="pln">php</span></code></li><li class="L8"><code class="language-php"><span class="pln">      </span><span class="pun">...</span></code></li></ol></pre><div class="md-section-divider"></div><h3 data-anchor-id="wh3h" id="2-切换语言">2. 切换语言</h3><p data-anchor-id="m29h">你应该将你正在使用的语言保存到一个会话变量中。</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="r4id"><ol class="linenums"><li class="L0"><code class="language-php"><span class="pln">$idiom </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">session</span><span class="pun">-&gt;</span><span class="pln">get_userdata</span><span class="pun">(</span><span class="str">'language'</span><span class="pun">);</span></code></li><li class="L1"><code class="language-php"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">lang</span><span class="pun">-&gt;</span><span class="pln">load</span><span class="pun">(</span><span class="str">'error_messages'</span><span class="pun">,</span><span class="pln"> $idiom</span><span class="pun">);</span></code></li><li class="L2"><code class="language-php"><span class="pln">$oops </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">lang</span><span class="pun">-&gt;</span><span class="pln">line</span><span class="pun">(</span><span class="str">'message_key'</span><span class="pun">);</span></code></li></ol></pre><div class="md-section-divider"></div><h3 data-anchor-id="9inl" id="3-国际化">3. 国际化</h3><p data-anchor-id="p1ep">CII 的语言类给你的应用程序提供了一种简单轻便的方式来实现多语言， 它并不是通常我们所说的 国际化与本地化 的完整实现。</p><p data-anchor-id="6qx5">我们可以给每一种语言一个别名，一个更通用的名字，而不是使用诸如 "en"、 "en-US"、"en-CA-x-ca" 这种国际标准的缩写名字。当然，你完全可以在你的程序中使用国际标准的缩写名字。</p><div class="md-section-divider"></div><h3 data-anchor-id="ns19" id="4-使用语言类">4. 使用语言类</h3><ul data-anchor-id="yp8f">
<li>创建语言文件：</li>
</ul><p data-anchor-id="xkbe">语言文件的命名可以任意，例如，你想创建一个包含错误消息的文件， 你可以把它命名为：error_lang.php 。</p><p data-anchor-id="yrz6">在此文件中，你可以在每行把一个字符串赋值给名为 $lang 的数组，例如:</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="uxqf"><ol class="linenums"><li class="L0"><code class="language-php"><span class="pln">$lang</span><span class="pun">[</span><span class="str">'language_key'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'The actual message to be shown'</span><span class="pun">;</span></code></li></ol></pre><p data-anchor-id="kloe">在每个文件中使用一个通用的前缀来避免和其他文件中的相似名称冲突是个好方法。 例如，如果你在创建错误消息你可以使用 error_ 前缀。</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="f3wn"><ol class="linenums"><li class="L0"><code class="language-php"><span class="pln">$lang</span><span class="pun">[</span><span class="str">'error_email_missing'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'You must submit an email address'</span><span class="pun">;</span></code></li><li class="L1"><code class="language-php"><span class="pln">$lang</span><span class="pun">[</span><span class="str">'error_url_missing'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'You must submit a URL'</span><span class="pun">;</span></code></li><li class="L2"><code class="language-php"><span class="pln">$lang</span><span class="pun">[</span><span class="str">'error_username_missing'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'You must submit a username'</span><span class="pun">;</span></code></li></ol></pre><ul data-anchor-id="gygg">
<li>加载语言文件：</li>
</ul><p data-anchor-id="q8do">在使用语言文件之前，你必须先加载它。可以使用下面的代码:</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="fbhc"><ol class="linenums"><li class="L0"><code class="language-php"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">lang</span><span class="pun">-&gt;</span><span class="pln">load</span><span class="pun">(</span><span class="str">'filename'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'language'</span><span class="pun">);</span></code></li></ol></pre><p data-anchor-id="u9r8">其中 filename 是你要加载的语言文件名，language 是要加载哪种语言（比如，英语）。如果没有第二个参数，将会使用 config/config.php 中设置的默认语言。</p><p data-anchor-id="dik0">你也可以通过传一个语言文件的数组给第一个参数来同时加载多个语言文件。</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="67dp"><ol class="linenums"><li class="L0"><code class="language-php"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">lang</span><span class="pun">-&gt;</span><span class="pln">load</span><span class="pun">(</span><span class="pln">array</span><span class="pun">(</span><span class="str">'filename1'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'filename2'</span><span class="pun">),</span><span class="pln"> </span><span class="str">'chinese'</span><span class="pun">);</span></code></li></ol></pre><p data-anchor-id="beax">language 参数只能包含字母。</p><ul data-anchor-id="0y1z">
<li>读取语言文本：</li>
</ul><p data-anchor-id="q24j">当你的语言文件已经加载，你就可以通过下面的方法来访问任何一行语言文本:</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="lq6a"><ol class="linenums"><li class="L0"><code class="language-php"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">lang</span><span class="pun">-&gt;</span><span class="pln">line</span><span class="pun">(</span><span class="str">'language_key'</span><span class="pun">);</span></code></li></ol></pre><p data-anchor-id="dwnb">其中 language_key 参数是你想显示的文本行所对应的数组的键名。</p><p data-anchor-id="e6tr">该方法只是简单的返回文本行，而不是显示出它。</p><ul data-anchor-id="7tas">
<li>返回语言文本：</li>
</ul><p data-anchor-id="e6ae">如果需要返回语言文本而不是加载它，使用第三个参数is_return，将返回读取的语言文本：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="wf6g"><ol class="linenums"><li class="L0"><code class="language-php"><span class="pln">$lang </span><span class="pun">=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">lang</span><span class="pun">-&gt;</span><span class="pln">load</span><span class="pun">(</span><span class="pln">array</span><span class="pun">(</span><span class="str">'filename1'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'filename2'</span><span class="pun">),</span><span class="pln"> </span><span class="str">'chinese'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span></code></li></ol></pre><p data-anchor-id="136u">变量 $lang 将会是包含了语言文本的数组。</p><ul data-anchor-id="p5ju">
<li>自动加载语言文件：</li>
</ul><p data-anchor-id="dg7y">如果你发现你需要在整个应用程序中使用某个语言文件，你可以让 CII 在系统初始化的时候自动加载该语言文件。 可以打开 config/autoload.php 文件，把语言放在 autoload 数组中。</p><hr><div class="md-section-divider"></div><h2 data-anchor-id="ux6e" id="分页类">分页类</h2><p data-anchor-id="11kv">CII_Pagination类是CodeIgniter框架中CI_Pagination类的扩展实现方式。</p><p data-anchor-id="djt8">内部结构</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="ai8q"><ol class="linenums"><li class="L0"><code class="language-php"><span class="typ">Class</span><span class="pln"> CII_Pagination</span><span class="pun">{</span></code></li><li class="L1"><code class="language-php"></code></li><li class="L2"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> $base_url </span><span class="pun">=</span><span class="pln"> NULL</span><span class="pun">;</span></code></li><li class="L3"><code class="language-php"><span class="pln">	</span><span class="kwd">public</span><span class="pln"> $total_rows </span><span class="pun">=</span><span class="pln"> NULL</span><span class="pun">;</span></code></li><li class="L4"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> $per_page </span><span class="pun">=</span><span class="pln"> NULL</span><span class="pun">;</span></code></li><li class="L5"><code class="language-php"></code></li><li class="L6"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> __construct</span><span class="pun">(){</span></code></li><li class="L7"><code class="language-php"><span class="pln">        </span><span class="com">// 初始化成员变量</span></code></li><li class="L8"><code class="language-php"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L9"><code class="language-php"></code></li><li class="L0"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> initialize</span><span class="pun">(</span><span class="pln">$config </span><span class="pun">=</span><span class="pln"> array</span><span class="pun">()){</span></code></li><li class="L1"><code class="language-php"><span class="pln">        </span><span class="com">// 通过参数为成员变量赋值</span></code></li><li class="L2"><code class="language-php"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L3"><code class="language-php"></code></li><li class="L4"><code class="language-php"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> create_links</span><span class="pun">(</span><span class="pln">$cur_page </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">){</span></code></li><li class="L5"><code class="language-php"><span class="pln">        </span><span class="com">// 生成分页字符串并返回字符串</span></code></li><li class="L6"><code class="language-php"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L7"><code class="language-php"><span class="pun">}</span></code></li></ol></pre><p data-anchor-id="1ioy">使用方法</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="owp2"><ol class="linenums"><li class="L0"><code class="language-php"><span class="com">// 生成对象</span></code></li><li class="L1"><code class="language-php"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">cii_pagination </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> cii_pagination</span><span class="pun">();</span></code></li><li class="L2"><code class="language-php"></code></li><li class="L3"><code class="language-php"><span class="com">// 设置分页控制器</span></code></li><li class="L4"><code class="language-php"><span class="pln">$cii_pagination</span><span class="pun">[</span><span class="str">'base_url'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'http://localhost:8888/ci/index.php/welcome/index/'</span><span class="pun">;</span></code></li><li class="L5"><code class="language-php"><span class="com">// 每页数量</span></code></li><li class="L6"><code class="language-php"><span class="pln">$cii_pagination</span><span class="pun">[</span><span class="str">'per_page'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">10</span><span class="pun">;</span></code></li><li class="L7"><code class="language-php"><span class="com">// 数据总量</span></code></li><li class="L8"><code class="language-php"><span class="pln">$cii_pagination</span><span class="pun">[</span><span class="str">'total_rows'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">56</span><span class="pun">;</span></code></li><li class="L9"><code class="language-php"><span class="com">// 初始化CII_Pagination分页类</span></code></li><li class="L0"><code class="language-php"><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">cii_pagination</span><span class="pun">-&gt;</span><span class="pln">initialize</span><span class="pun">(</span><span class="pln">$cii_pagination</span><span class="pun">);</span></code></li><li class="L1"><code class="language-php"><span class="com">// 输出分页，参数为当前页面，通过uri获取</span></code></li><li class="L2"><code class="language-php"><span class="pln">echo $this</span><span class="pun">-&gt;</span><span class="pln">cii_pagination</span><span class="pun">-&gt;</span><span class="pln">create_links</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">uri</span><span class="pun">-&gt;</span><span class="pln">segment</span><span class="pun">(</span><span class="lit">3</span><span class="pun">));</span></code></li></ol></pre><p data-anchor-id="372c">性能测试</p><p data-anchor-id="wbm7">使用CodeIgniter框架的CI_Pagination类与CII_Pagination类输出相同分页结果，计算耗时。</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="41b2"><ol class="linenums"><li class="L0"><code class="language-php"><span class="tag">&lt;style</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"text/css"</span><span class="tag">&gt;</span></code></li><li class="L1"><code class="language-php"><span class="pln">body </span><span class="pun">{</span></code></li><li class="L2"><code class="language-php"><span class="pln">  padding</span><span class="pun">:</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L3"><code class="language-php"><span class="pln">  margin</span><span class="pun">:</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span></code></li><li class="L4"><code class="language-php"><span class="pln">  min</span><span class="pun">-</span><span class="pln">height</span><span class="pun">:</span><span class="pln"> </span><span class="lit">100</span><span class="pun">%;</span></code></li><li class="L5"><code class="language-php"><span class="pln">  font</span><span class="pun">-</span><span class="pln">size</span><span class="pun">:</span><span class="pln"> </span><span class="lit">12px</span><span class="pun">;</span></code></li><li class="L6"><code class="language-php"><span class="pln">  font</span><span class="pun">-</span><span class="pln">family</span><span class="pun">:</span><span class="pln"> </span><span class="pun">微软雅黑,</span><span class="pln"> </span><span class="pun">冬青黑体,</span><span class="pln"> </span><span class="pun">宋体,</span><span class="pln"> arial</span><span class="pun">;</span></code></li><li class="L7"><code class="language-php"><span class="pln">  color</span><span class="pun">:</span><span class="pln"> </span><span class="com">#333; }</span></code></li><li class="L8"><code class="language-php"><span class="pln">    </span><span class="pun">.</span><span class="pln">view</span><span class="pun">-</span><span class="pln">container</span><span class="pun">{</span></code></li><li class="L9"><code class="language-php"><span class="pln">        padding</span><span class="pun">:</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="lit">10px</span><span class="pun">;</span></code></li><li class="L0"><code class="language-php"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L1"><code class="language-php"><span class="pln">    </span><span class="pun">.</span><span class="pln">view</span><span class="pun">-</span><span class="pln">container </span><span class="pun">.</span><span class="pln">pn </span><span class="pun">.</span><span class="pln">pn</span><span class="pun">-</span><span class="pln">container </span><span class="pun">{</span></code></li><li class="L2"><code class="language-php"><span class="pln">        </span><span class="kwd">float</span><span class="pun">:</span><span class="pln"> left</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span></code></li><li class="L3"><code class="language-php"><span class="pln">        </span><span class="pun">.</span><span class="pln">view</span><span class="pun">-</span><span class="pln">container </span><span class="pun">.</span><span class="pln">pn </span><span class="pun">.</span><span class="pln">pn</span><span class="pun">-</span><span class="pln">container span </span><span class="pun">{</span></code></li><li class="L4"><code class="language-php"><span class="pln">          </span><span class="kwd">float</span><span class="pun">:</span><span class="pln"> left</span><span class="pun">;</span></code></li><li class="L5"><code class="language-php"><span class="pln">          margin</span><span class="pun">-</span><span class="pln">right</span><span class="pun">:</span><span class="pln"> </span><span class="lit">10px</span><span class="pun">;</span></code></li><li class="L6"><code class="language-php"><span class="pln">          font</span><span class="pun">-</span><span class="pln">size</span><span class="pun">:</span><span class="pln"> </span><span class="lit">14px</span><span class="pun">;</span></code></li><li class="L7"><code class="language-php"><span class="pln">          line</span><span class="pun">-</span><span class="pln">height</span><span class="pun">:</span><span class="pln"> </span><span class="lit">24px</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span></code></li><li class="L8"><code class="language-php"><span class="pln">          </span><span class="pun">.</span><span class="pln">view</span><span class="pun">-</span><span class="pln">container </span><span class="pun">.</span><span class="pln">pn </span><span class="pun">.</span><span class="pln">pn</span><span class="pun">-</span><span class="pln">container span a </span><span class="pun">{</span></code></li><li class="L9"><code class="language-php"><span class="pln">            display</span><span class="pun">:</span><span class="pln"> block</span><span class="pun">;</span></code></li><li class="L0"><code class="language-php"><span class="pln">            padding</span><span class="pun">:</span><span class="pln"> </span><span class="lit">2px</span><span class="pln"> </span><span class="lit">10px</span><span class="pun">;</span></code></li><li class="L1"><code class="language-php"><span class="pln">            color</span><span class="pun">:</span><span class="pln"> </span><span class="com">#747474;</span></code></li><li class="L2"><code class="language-php"><span class="pln">            background</span><span class="pun">-</span><span class="pln">color</span><span class="pun">:</span><span class="pln"> </span><span class="com">#EDF2F8; </span></code></li><li class="L3"><code class="language-php"><span class="pln">            text</span><span class="pun">-</span><span class="pln">decoration</span><span class="pun">:</span><span class="pln"> none</span><span class="pun">;</span><span class="pln"> </span><span class="pun">}</span></code></li><li class="L4"><code class="language-php"><span class="pln">            </span><span class="pun">.</span><span class="pln">view</span><span class="pun">-</span><span class="pln">container </span><span class="pun">.</span><span class="pln">pn </span><span class="pun">.</span><span class="pln">pn</span><span class="pun">-</span><span class="pln">container span a</span><span class="pun">:</span><span class="pln">hover </span><span class="pun">{</span></code></li><li class="L5"><code class="language-php"><span class="pln">              background</span><span class="pun">-</span><span class="pln">color</span><span class="pun">:</span><span class="pln"> </span><span class="com">#a4bddb;</span></code></li><li class="L6"><code class="language-php"><span class="pln">              color</span><span class="pun">:</span><span class="pln"> </span><span class="com">#FFF; }</span></code></li><li class="L7"><code class="language-php"><span class="pln">          </span><span class="pun">.</span><span class="pln">view</span><span class="pun">-</span><span class="pln">container </span><span class="pun">.</span><span class="pln">pn </span><span class="pun">.</span><span class="pln">pn</span><span class="pun">-</span><span class="pln">container span</span><span class="pun">.</span><span class="pln">current </span><span class="pun">{</span></code></li><li class="L8"><code class="language-php"><span class="pln">            padding</span><span class="pun">:</span><span class="pln"> </span><span class="lit">2px</span><span class="pln"> </span><span class="lit">10px</span><span class="pun">;</span></code></li><li class="L9"><code class="language-php"><span class="pln">            background</span><span class="pun">-</span><span class="pln">color</span><span class="pun">:</span><span class="pln"> </span><span class="com">#a4bddb;</span></code></li><li class="L0"><code class="language-php"><span class="pln">            color</span><span class="pun">:</span><span class="pln"> </span><span class="com">#FFF; }</span></code></li><li class="L1"><code class="language-php"><span class="pln">    </span><span class="pun">.</span><span class="pln">clearfix</span><span class="pun">{</span></code></li><li class="L2"><code class="language-php"><span class="pln">        clear</span><span class="pun">:</span><span class="pln">both</span><span class="pun">;</span></code></li><li class="L3"><code class="language-php"><span class="pln">        </span><span class="kwd">float</span><span class="pun">:</span><span class="pln"> none</span><span class="pun">;</span></code></li><li class="L4"><code class="language-php"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L5"><code class="language-php"><span class="tag">&lt;/style&gt;</span></code></li><li class="L6"><code class="language-php"><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"view-container"</span><span class="tag">&gt;</span></code></li><li class="L7"><code class="language-php"><span class="pln">    </span><span class="pun">&lt;?</span><span class="pln">php</span></code></li><li class="L8"><code class="language-php"><span class="pln">        echo </span><span class="str">"&lt;p&gt;CI_Pagination: &lt;/p&gt;"</span><span class="pun">;</span></code></li><li class="L9"><code class="language-php"><span class="pln">        $this</span><span class="pun">-&gt;</span><span class="pln">benchmark</span><span class="pun">-&gt;</span><span class="pln">mark</span><span class="pun">(</span><span class="str">'pagination_code_start'</span><span class="pun">);</span></code></li><li class="L0"><code class="language-php"><span class="pln">		$pagination</span><span class="pun">[</span><span class="str">'full_tag_open'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'&lt;div class="pn"&gt;&lt;div class="pn-container"&gt;'</span><span class="pun">;</span></code></li><li class="L1"><code class="language-php"><span class="pln">        $pagination</span><span class="pun">[</span><span class="str">'full_tag_close'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'&lt;div class="clearfix"&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class="clearfix"&gt;&lt;/div&gt;&lt;/div&gt;'</span><span class="pun">;</span></code></li><li class="L2"><code class="language-php"><span class="pln">		$pagination</span><span class="pun">[</span><span class="str">'first_tag_open'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'&lt;span&gt;'</span><span class="pun">;</span></code></li><li class="L3"><code class="language-php"><span class="pln">        $pagination</span><span class="pun">[</span><span class="str">'first_tag_close'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'&lt;/span&gt;'</span><span class="pun">;</span></code></li><li class="L4"><code class="language-php"><span class="pln">		$pagination</span><span class="pun">[</span><span class="str">'last_tag_open'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'&lt;span&gt;'</span><span class="pun">;</span></code></li><li class="L5"><code class="language-php"><span class="pln">        $pagination</span><span class="pun">[</span><span class="str">'last_tag_close'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'&lt;/span&gt;'</span><span class="pun">;</span></code></li><li class="L6"><code class="language-php"><span class="pln">		$pagination</span><span class="pun">[</span><span class="str">'next_tag_open'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'&lt;span&gt;'</span><span class="pun">;</span></code></li><li class="L7"><code class="language-php"><span class="pln">        $pagination</span><span class="pun">[</span><span class="str">'next_tag_close'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'&lt;/span&gt;'</span><span class="pun">;</span></code></li><li class="L8"><code class="language-php"><span class="pln">		$pagination</span><span class="pun">[</span><span class="str">'prev_tag_open'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'&lt;span&gt;'</span><span class="pun">;</span></code></li><li class="L9"><code class="language-php"><span class="pln">        $pagination</span><span class="pun">[</span><span class="str">'prev_tag_close'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'&lt;/span&gt;'</span><span class="pun">;</span></code></li><li class="L0"><code class="language-php"><span class="pln">		$pagination</span><span class="pun">[</span><span class="str">'cur_tag_open'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'&lt;span class="current"&gt;'</span><span class="pun">;</span></code></li><li class="L1"><code class="language-php"><span class="pln">        $pagination</span><span class="pun">[</span><span class="str">'cur_tag_close'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'&lt;/span&gt;'</span><span class="pun">;</span></code></li><li class="L2"><code class="language-php"><span class="pln">		$pagination</span><span class="pun">[</span><span class="str">'num_tag_open'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'&lt;span&gt;'</span><span class="pun">;</span></code></li><li class="L3"><code class="language-php"><span class="pln">        $pagination</span><span class="pun">[</span><span class="str">'num_tag_close'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'&lt;/span&gt;'</span><span class="pun">;</span></code></li><li class="L4"><code class="language-php"><span class="pln">		$pagination</span><span class="pun">[</span><span class="str">'use_page_numbers'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span></code></li><li class="L5"><code class="language-php"><span class="pln">        $pagination</span><span class="pun">[</span><span class="str">'first_link'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'首页'</span><span class="pun">;</span></code></li><li class="L6"><code class="language-php"><span class="pln">		$pagination</span><span class="pun">[</span><span class="str">'prev_link'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'上一页'</span><span class="pun">;</span></code></li><li class="L7"><code class="language-php"><span class="pln">        $pagination</span><span class="pun">[</span><span class="str">'next_link'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'下一页'</span><span class="pun">;</span></code></li><li class="L8"><code class="language-php"><span class="pln">		$pagination</span><span class="pun">[</span><span class="str">'last_link'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'尾页'</span><span class="pun">;</span></code></li><li class="L9"><code class="language-php"><span class="pln">        $pagination</span><span class="pun">[</span><span class="str">'base_url'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'http://localhost:8888/ci/index.php/welcome/index/'</span><span class="pun">;</span></code></li><li class="L0"><code class="language-php"><span class="pln">		$pagination</span><span class="pun">[</span><span class="str">'per_page'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">10</span><span class="pun">;</span></code></li><li class="L1"><code class="language-php"><span class="pln">        $pagination</span><span class="pun">[</span><span class="str">'total_rows'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">56</span><span class="pun">;</span></code></li><li class="L2"><code class="language-php"><span class="pln">		$this</span><span class="pun">-&gt;</span><span class="pln">pagination</span><span class="pun">-&gt;</span><span class="pln">initialize</span><span class="pun">(</span><span class="pln">$pagination</span><span class="pun">);</span></code></li><li class="L3"><code class="language-php"><span class="pln">		echo $this</span><span class="pun">-&gt;</span><span class="pln">pagination</span><span class="pun">-&gt;</span><span class="pln">create_links</span><span class="pun">();</span></code></li><li class="L4"><code class="language-php"><span class="pln">        $this</span><span class="pun">-&gt;</span><span class="pln">benchmark</span><span class="pun">-&gt;</span><span class="pln">mark</span><span class="pun">(</span><span class="str">'pagination_code_end'</span><span class="pun">);</span></code></li><li class="L5"><code class="language-php"><span class="pln">		echo </span><span class="str">'&lt;p&gt;Time : '</span><span class="pun">.</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">benchmark</span><span class="pun">-&gt;</span><span class="pln">elapsed_time</span><span class="pun">(</span><span class="str">'pagination_code_start'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'pagination_code_end'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">22</span><span class="pun">).</span><span class="str">'&lt;/p&gt;'</span><span class="pun">;</span></code></li><li class="L6"><code class="language-php"><span class="pln">    </span><span class="pun">?&gt;</span></code></li><li class="L7"><code class="language-php"><span class="tag">&lt;/div&gt;</span></code></li><li class="L8"><code class="language-php"><span class="tag">&lt;hr/&gt;</span></code></li><li class="L9"><code class="language-php"><span class="tag">&lt;div</span><span class="pln"> </span><span class="atn">class</span><span class="pun">=</span><span class="atv">"view-container"</span><span class="tag">&gt;</span></code></li><li class="L0"><code class="language-php"><span class="pln">    </span><span class="pun">&lt;?</span><span class="pln">php</span></code></li><li class="L1"><code class="language-php"><span class="pln">        echo </span><span class="str">"&lt;p&gt;CII_Pagination: &lt;/p&gt;"</span><span class="pun">;</span></code></li><li class="L2"><code class="language-php"><span class="pln">        $this</span><span class="pun">-&gt;</span><span class="pln">benchmark</span><span class="pun">-&gt;</span><span class="pln">mark</span><span class="pun">(</span><span class="str">'cii_pagination_code_start'</span><span class="pun">);</span></code></li><li class="L3"><code class="language-php"><span class="pln">		$cii_pagination</span><span class="pun">[</span><span class="str">'base_url'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="str">'http://localhost:8888/ci/index.php/welcome/index/'</span><span class="pun">;</span></code></li><li class="L4"><code class="language-php"><span class="pln">        $cii_pagination</span><span class="pun">[</span><span class="str">'per_page'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">10</span><span class="pun">;</span></code></li><li class="L5"><code class="language-php"><span class="pln">		$cii_pagination</span><span class="pun">[</span><span class="str">'total_rows'</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">56</span><span class="pun">;</span></code></li><li class="L6"><code class="language-php"><span class="pln">        $this</span><span class="pun">-&gt;</span><span class="pln">cii_pagination</span><span class="pun">-&gt;</span><span class="pln">initialize</span><span class="pun">(</span><span class="pln">$cii_pagination</span><span class="pun">);</span></code></li><li class="L7"><code class="language-php"><span class="pln">        echo $this</span><span class="pun">-&gt;</span><span class="pln">cii_pagination</span><span class="pun">-&gt;</span><span class="pln">create_links</span><span class="pun">(</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">uri</span><span class="pun">-&gt;</span><span class="pln">segment</span><span class="pun">(</span><span class="lit">3</span><span class="pun">));</span></code></li><li class="L8"><code class="language-php"><span class="pln">        $this</span><span class="pun">-&gt;</span><span class="pln">benchmark</span><span class="pun">-&gt;</span><span class="pln">mark</span><span class="pun">(</span><span class="str">'cii_pagination_code_end'</span><span class="pun">);</span></code></li><li class="L9"><code class="language-php"><span class="pln">		echo </span><span class="str">'&lt;p&gt;Time : '</span><span class="pun">.</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">benchmark</span><span class="pun">-&gt;</span><span class="pln">elapsed_time</span><span class="pun">(</span><span class="str">'cii_pagination_code_start'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'cii_pagination_code_end'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">22</span><span class="pun">).</span><span class="str">'&lt;/p&gt;'</span><span class="pun">;</span></code></li><li class="L0"><code class="language-php"><span class="pln">    </span><span class="pun">?&gt;</span></code></li><li class="L1"><code class="language-php"><span class="tag">&lt;/div&gt;</span></code></li></ol></pre><p data-anchor-id="s0rx">结果：</p><p data-anchor-id="s9z0"><a href="https://github.com/miaojuanfeng/cii_pagination/blob/master/tests/runtime.png?raw=true" class="attachment-block" target="_blank"><i class="icon-file-alt icon-4x"></i><span class="attachment-filename">runtime.png?raw=true</span><span class="attachment-filesize">未知大小</span></a></p><p data-anchor-id="g96h">CII_Pagination类生成的结果与CI_Pagination类生成的结果完全一致，通过CodeIgniter框架的基准测试类得出CII_Pagination的运行时间比CI_Pagination快了近10倍。</p><hr></div>
</body>
</html>